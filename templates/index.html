<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Générateur CV & Lettre de Motivation</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/static/style.css">
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: #f4f4f9;
        }
        .container {
            max-width: 720px;
            margin: 0 auto;
            background: #fff;
            border-radius: 1.5rem;
            box-shadow: 0 0 15px #bbb5;
            padding: 2rem 1.2rem;
            margin-top: 2rem;
        }
        h1, h2 {
            color: #175076;
            text-align: center;
        }
        label {
            display: block;
            font-weight: bold;
            margin: 0.7em 0 0.3em 0;
        }
        input, textarea, select {
            width: 100%;
            padding: 0.7em;
            margin-bottom: 0.5em;
            border-radius: 0.7em;
            border: 1px solid #d3d3d3;
            font-size: 1em;
            background: #f9fafd;
        }
        input[type="file"] {
            padding: 0.4em;
        }
        .xp-block, .dip-block {
            border: 1px solid #dde1e7;
            padding: 0.9em;
            border-radius: 1em;
            margin-bottom: 0.7em;
            background: #f8fbfd;
            position: relative;
        }
        .add-btn, .remove-btn {
            background: #2583c6;
            color: #fff;
            border: none;
            border-radius: 50%;
            width: 2.1em;
            height: 2.1em;
            font-size: 1.4em;
            font-weight: bold;
            cursor: pointer;
            margin: 0 0.4em;
        }
        .remove-btn {
            background: #c62828;
        }
        .actions {
            text-align: center;
        }
        .btn-primary {
            background: #2184c9;
            color: #fff;
            padding: 1em 2em;
            font-size: 1.15em;
            border: none;
            border-radius: 0.7em;
            cursor: pointer;
            margin-top: 1.2em;
            box-shadow: 0 2px 10px #17325024;
            transition: background 0.2s;
        }
        .btn-primary:hover {
            background: #1668a7;
        }
        .error-msg {
            color: #c62828;
            background: #fff3f3;
            border: 1px solid #c62828;
            border-radius: 1em;
            padding: 1em;
            margin-bottom: 1.2em;
            font-weight: bold;
        }
        @media (max-width: 600px) {
            .container { padding: 0.7em; margin-top: 0.7em; }
            input, textarea, select { font-size: 1em; }
            h1 { font-size: 1.3em; }
            .btn-primary { font-size: 1em; padding: 0.7em 1.4em; }
        }
    </style>
</head>
<body>
<div class="container">
    <h1>Générateur CV & Lettre de Motivation IA</h1>
    {% if error %}
        <div class="error-msg">{{ error }}</div>
    {% endif %}
    <form method="post" enctype="multipart/form-data" id="cvlmForm">
        <h2>Vos informations personnelles</h2>
        <label>Nom :</label>
        <input type="text" name="nom" value="{{ nom or '' }}" required>
        <label>Prénom :</label>
        <input type="text" name="prenom" value="{{ prenom or '' }}" required>
        <label>Adresse :</label>
        <input type="text" name="adresse" value="{{ adresse or '' }}">
        <label>Téléphone :</label>
        <input type="tel" name="telephone" value="{{ telephone or '' }}">
        <label>Email :</label>
        <input type="email" name="email" value="{{ email or '' }}">
        <label>Âge :</label>
        <input type="number" name="age" min="15" max="100" value="{{ age or '' }}">

        <h2>Expériences professionnelles</h2>
        <div id="xp-list">
            {% set xp_nb = xp_poste|length if xp_poste else 1 %}
            {% for i in range(xp_nb) %}
            <div class="xp-block">
                <label>Poste :</label>
                <input type="text" name="xp_poste" value="{{ xp_poste[i] if xp_poste and xp_poste|length > i else '' }}">
                <label>Entreprise :</label>
                <input type="text" name="xp_entreprise" value="{{ xp_entreprise[i] if xp_entreprise and xp_entreprise|length > i else '' }}">
                <label>Lieu :</label>
                <input type="text" name="xp_lieu" value="{{ xp_lieu[i] if xp_lieu and xp_lieu|length > i else '' }}">
                <label>Date début :</label>
                <input type="text" name="xp_debut" value="{{ xp_debut[i] if xp_debut and xp_debut|length > i else '' }}" placeholder="MM/AAAA">
                <label>Date fin :</label>
                <input type="text" name="xp_fin" value="{{ xp_fin[i] if xp_fin and xp_fin|length > i else '' }}" placeholder="MM/AAAA ou en cours">
                <button type="button" class="remove-btn" onclick="removeXP(this)">−</button>
            </div>
            {% endfor %}
        </div>
        <button type="button" class="add-btn" onclick="addXP()">+</button>

        <h2>Diplômes & formations</h2>
        <div id="dip-list">
            {% set dip_nb = dip_titre|length if dip_titre else 1 %}
            {% for i in range(dip_nb) %}
            <div class="dip-block">
                <label>Intitulé du diplôme :</label>
                <input type="text" name="dip_titre" value="{{ dip_titre[i] if dip_titre and dip_titre|length > i else '' }}">
                <label>Établissement / Lieu :</label>
                <input type="text" name="dip_lieu" value="{{ dip_lieu[i] if dip_lieu and dip_lieu|length > i else '' }}">
                <label>Date d'obtention :</label>
                <input type="text" name="dip_date" value="{{ dip_date[i] if dip_date and dip_date|length > i else '' }}" placeholder="MM/AAAA">
                <button type="button" class="remove-btn" onclick="removeDip(this)">−</button>
            </div>
            {% endfor %}
        </div>
        <button type="button" class="add-btn" onclick="addDip()">+</button>

        <h2>Ou bien, chargez directement votre CV (PDF ou DOCX)</h2>
        <input type="file" name="cv_file" accept=".pdf,.docx">

        <h2>Copiez/collez ici l'offre d'emploi</h2>
        <textarea name="description" rows="7" placeholder="Copiez ici l'intégralité du texte de l'offre à laquelle vous postulez" required>{{ description or '' }}</textarea>

        <div class="actions">
            <button type="submit" class="btn-primary">Générer CV et Lettre de motivation</button>
        </div>
    </form>
    <p style="text-align:center;font-size:0.93em;color:#888;margin-top:1.6em">
        <em>Vos données ne sont pas conservées.<br>Projet open source, IA Groq / Llama4, sans stockage.</em>
    </p>
</div>

<script>
    // Ajout/Retrait XP
    function addXP() {
        let xpList = document.getElementById('xp-list');
        let block = document.createElement('div');
        block.className = 'xp-block';
        block.innerHTML = `
            <label>Poste :</label>
            <input type="text" name="xp_poste">
            <label>Entreprise :</label>
            <input type="text" name="xp_entreprise">
            <label>Lieu :</label>
            <input type="text" name="xp_lieu">
            <label>Date début :</label>
            <input type="text" name="xp_debut" placeholder="MM/AAAA">
            <label>Date fin :</label>
            <input type="text" name="xp_fin" placeholder="MM/AAAA ou en cours">
            <button type="button" class="remove-btn" onclick="removeXP(this)">−</button>
        `;
        xpList.appendChild(block);
    }
    function removeXP(btn) {
        let block = btn.parentElement;
        block.parentElement.removeChild(block);
    }

    // Ajout/Retrait Diplômes
    function addDip() {
        let dipList = document.getElementById('dip-list');
        let block = document.createElement('div');
        block.className = 'dip-block';
        block.innerHTML = `
            <label>Intitulé du diplôme :</label>
            <input type="text" name="dip_titre">
            <label>Établissement / Lieu :</label>
            <input type="text" name="dip_lieu">
            <label>Date d'obtention :</label>
            <input type="text" name="dip_date" placeholder="MM/AAAA">
            <button type="button" class="remove-btn" onclick="removeDip(this)">−</button>
        `;
        dipList.appendChild(block);
    }
    function removeDip(btn) {
        let block = btn.parentElement;
        block.parentElement.removeChild(block);
    }
</script>
</body>
</html>
