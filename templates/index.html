<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>G√©n√©rateur de CV & Lettre de motivation | IA personnalis√©e</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <!-- Chargement du CSS externe -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

    <button id="themeSwitcher" class="theme-switcher" title="Changer de th√®me">üåò</button>

    <div class="container">
        <div class="header">
            <img src="{{ url_for('static', filename='logo.gif') }}" alt="Logo" class="logo">
            <h1 class="main-title">
                <span class="main-title-icon">ü§ñ</span>
                G√©n√©rateur de <span class="cv">CV</span> & <span class="lm">Lettre de motivation</span> <span class="ia">IA</span>
            </h1>
        </div>
        {% if error %}
        <div class="error">{{ error }}</div>
        {% endif %}

        <form method="POST" enctype="multipart/form-data" autocomplete="off" id="mainForm">
            <div class="upload-zone">
                <label for="cv_file" class="upload-label" style="display: block;">
                    <span style="display:block;">üìÅ Charger mon CV</span>
                    <span style="
                        display:block;
                        font-size: 1em;
                        font-weight:normal;
                        margin-top:3px;
                        text-align:center;
                        color:#cfe4ff;
                        font-style:italic;
                        letter-spacing: 0.2px;
                    ">
                        (PDF ou DOCX)
                    </span>
                </label>
                <input type="file" name="cv_file" id="cv_file" accept=".pdf,.docx">
                <div class="upload-infos">
                    Vous pouvez uploader un CV‚ÄØ: il sera analys√© automatiquement.<br>
                    <b>Sinon‚ÄØ: compl√©tez-le manuellement ci-dessous.</b>
                </div>
                <div class="upload-file-info" id="uploadedFileName" style="display:none;"></div>
            </div>
            <div class="manual-prompt" style="text-align:center;">
                <span style="display:block;">Vous n‚Äôavez pas de CV‚ÄØ?</span>
                <span style="display:block; color:#437bda; font-style:italic; margin-top:3px;">
                    Compl√©tez le formulaire manuellement
                </span>
            </div>

            <div class="show-manual" id="showManualBtn">
                <span class="plusicon">+</span>
                Ajouter ou modifier mon CV manuellement
            </div>
            <div class="manual-section" id="manualSection">
                <div class="field-row">
                    <div>
                        <label for="nom">Nom</label>
                        <input type="text" name="nom" id="nom" value="{{ nom or '' }}">
                    </div>
                    <div>
                        <label for="prenom">Pr√©nom</label>
                        <input type="text" name="prenom" id="prenom" value="{{ prenom or '' }}">
                    </div>
                </div>
                <label for="adresse">Adresse</label>
                <input type="text" name="adresse" id="adresse" value="{{ adresse or '' }}">
                <div class="field-row">
                    <div>
                        <label for="telephone">T√©l√©phone</label>
                        <input type="text" name="telephone" id="telephone" value="{{ telephone or '' }}">
                    </div>
                    <div>
                        <label for="email">Email</label>
                        <input type="email" name="email" id="email" value="{{ email or '' }}">
                    </div>
                    <div>
                        <label for="age">√Çge</label>
                        <input type="number" name="age" id="age" min="14" max="80" value="{{ age or '' }}">
                    </div>
                </div>
                <h3>Exp√©riences professionnelles</h3>
                <div id="xpList">
                    {% for i in range(xp_poste|length) %}
                    <div class="field-row xp-row">
                        <div>
                            <input type="text" name="xp_poste" placeholder="Poste occup√©" value="{{ xp_poste[i] }}">
                        </div>
                        <div>
                            <input type="text" name="xp_entreprise" placeholder="Entreprise" value="{{ xp_entreprise[i] }}">
                        </div>
                        <div>
                            <input type="text" name="xp_lieu" placeholder="Lieu" value="{{ xp_lieu[i] }}">
                        </div>
                        <div>
                            <input type="text" name="xp_debut" placeholder="D√©but (AAAA-MM)" value="{{ xp_debut[i] }}">
                        </div>
                        <div>
                            <input type="text" name="xp_fin" placeholder="Fin (AAAA-MM ou actuel)" value="{{ xp_fin[i] }}">
                        </div>
                        <button type="button" class="suppr-btn" onclick="this.parentNode.remove()">√ó</button>
                    </div>
                    {% endfor %}
                </div>
                <button type="button" class="add-btn" onclick="addXp()">+ Ajouter une exp√©rience</button>
                <h3>Dipl√¥mes</h3>
                <div id="dipList">
                    {% for i in range(dip_titre|length) %}
                    <div class="field-row dip-row">
                        <div>
                            <input type="text" name="dip_titre" placeholder="Intitul√© du dipl√¥me" value="{{ dip_titre[i] }}">
                        </div>
                        <div>
                            <input type="text" name="dip_lieu" placeholder="Lieu d'obtention" value="{{ dip_lieu[i] }}">
                        </div>
                        <div>
                            <input type="text" name="dip_date" placeholder="Date (AAAA)" value="{{ dip_date[i] }}">
                        </div>
                        <button type="button" class="suppr-btn" onclick="this.parentNode.remove()">√ó</button>
                    </div>
                    {% endfor %}
                </div>
                <button type="button" class="add-btn" onclick="addDip()">+ Ajouter un dipl√¥me</button>
            </div>

            <!-- PATCH OFFRE D'EMPLOI ‚Äî D√âBUT -->
            <div class="form-section">
                <label for="offer_url" class="label-annonce" style="display:block; line-height:1.35; padding-top:4px;">
                    <span style="display:block; text-align:center; font-size:1.55em; margin-bottom:2px;">üìÑ</span>
                    <span style="display:block; text-align:center;">Offre d'emploi :</span>
                    <span style="display:block; text-align:center; color:#427cff; font-style:italic; font-size:0.97em; margin-top:7px;">
                        Collez le lien URL <b>OU</b> cliquez sur <b>+</b> pour saisir/coller le texte int√©gral
                    </span>
                </label>
                <input type="url" name="offer_url" id="offer_url"
                    placeholder="Collez l'URL de l'offre d'emploi ici"
                    value="{{ offer_url or '' }}"
                    style="width:100%;margin-bottom:6px;" />

                <button type="button" id="toggle-offer-manual" style="margin-bottom:6px;">+ Saisir l‚Äôoffre manuellement</button>

                <div id="offer-manual-section" style="display: none;">
                    <textarea name="offer_text" id="offer_text" rows="8"
                        placeholder="Ou collez ici le texte int√©gral de l‚Äôoffre d‚Äôemploi..." style="width:100%;">{{ offer_text or '' }}</textarea>
                </div>
                {% if error_offer %}
                <div class="error" style="margin:12px 0 8px 0;">{{ error_offer }}</div>
                {% endif %}
            </div>
            <!-- PATCH OFFRE D'EMPLOI ‚Äî FIN -->

            <button type="submit" class="submit-btn">G√©n√©rer mon CV et ma lettre de motivation</button>
        </form>
    </div>

    <!-- Loader animation overlay -->
    <div id="loader-overlay">
        <div class="loader-spinner"></div>
        <div style="color:#333; margin-top:28px; font-weight:700;">G√©n√©ration en cours...<br>Patiente un peu fr√©rot !</div>
    </div>

    <!-- Compteur visiteurs SVG (LIVE, fiable) -->
    <div style="text-align:center; margin-top:30px; margin-bottom:8px;">
        <img src="https://counter1.optistats.ovh/private/compteurdevisite.php?c=2bw6u8qr675m9ldkgse72a1jpe84a7q1" border="0" title="compteur site" alt="compteur site" style="vertical-align:middle;">
    </div>

    <div class="footer">
        Projet sign√© <b>s00r1</b> ‚Äì 2025
    </div>

    <!-- Ton JS g√©n√©ral -->
    <script src="{{ url_for('static', filename='scripts.js') }}"></script>

    <script>
    // Affichage/d√©pliage zone saisie manuelle de l'offre
    document.getElementById('toggle-offer-manual').addEventListener('click', function() {
        const section = document.getElementById('offer-manual-section');
        if (section.style.display === 'none' || section.style.display === '') {
            section.style.display = 'block';
            this.textContent = '‚Äì Masquer la saisie manuelle';
        } else {
            section.style.display = 'none';
            this.textContent = '+ Saisir l‚Äôoffre manuellement';
        }
    });
    // Ouvre automatiquement la saisie manuelle si une erreur d'offre est pr√©sente
    {% if error_offer %}
    document.getElementById('offer-manual-section').style.display = 'block';
    document.getElementById('toggle-offer-manual').textContent = '‚Äì Masquer la saisie manuelle';
    {% endif %}
    </script>

    <!--Start of Tawk.to Script-->
    <script type="text/javascript">
    var Tawk_API=Tawk_API||{}, Tawk_LoadStart=new Date();
    (function(){
    var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
    s1.async=true;
    s1.src='https://embed.tawk.to/6835bdc457e311191f709c17/1is8uqhpq';
    s1.charset='UTF-8';
    s1.setAttribute('crossorigin','*');
    s0.parentNode.insertBefore(s1,s0);
    })();
    </script>
    <!--End of Tawk.to Script-->

</body>
</html>
