<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Générateur CV / Lettre de motivation / Fiche de poste</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <style>
        body { background: #f4f6fb; margin: 0; font-family: 'Segoe UI', Arial, sans-serif; color: #182145; }
        .container {
            max-width: 680px;
            margin: 40px auto 24px auto;
            background: #fff;
            border-radius: 17px;
            box-shadow: 0 4px 32px #bfd8ff34;
            padding: 32px 30px 24px 30px;
        }
        h1 { color: #1a2fb0; text-align:center; font-size:2em; letter-spacing:-1px; margin-bottom:18px;}
        h2 { color: #273469; font-size:1.25em;}
        label { font-weight: 500; display:block; margin:19px 0 7px 2px;}
        input[type=text], input[type=email], input[type=number], textarea, input[type=file] {
            width:100%; padding:10px; border-radius:7px;
            border:1.2px solid #d3def5; font-size:1em; background:#f9fbff;
            margin-bottom: 8px;
        }
        textarea { min-height:100px; resize:vertical;}
        .row-flex { display:flex; gap:13px; flex-wrap:wrap;}
        .xp-block, .dip-block {
            background:#f6f8ff;
            border-radius:8px;
            padding:13px 15px 9px 15px;
            margin-bottom:12px;
            border: 1px solid #d3e5ff;
        }
        .add-btn {
            background:#234fd1; color:#fff;
            border:none; border-radius:7px; padding:7px 17px;
            font-size:1em; cursor:pointer;
            margin:10px 0 17px 0;
            font-weight:500; box-shadow: 0 2px 8px #cad7fc23;
            transition: background .2s;
        }
        .add-btn:hover, .add-btn:focus { background:#3b5ee6; }
        .file-upload { margin:20px 0 23px 0; }
        .file-upload input[type=file] { border:1.2px solid #d3def5; border-radius:6px; background:#f8faff;}
        .or-separator {
            text-align:center; color:#aaa; margin: 13px 0 15px 0;
            font-weight:600; letter-spacing: .5px; font-size:.99em;
        }
        .important {color:#c01e2d; font-weight:700;}
        button[type=submit] {
            margin-top:24px; width:100%;
            font-size:1.15em; padding:12px 0; background:#2745d4;
            color:#fff; border-radius:9px; border:none; font-weight:600; cursor:pointer;
            box-shadow: 0 2px 8px #bdd1fd35; transition: background .2s;
        }
        button[type=submit]:hover { background:#4964e6;}
        .error-message { color:#c01e2d; background:#fff0f3; padding:10px 14px; border-radius:7px; margin-bottom:13px; text-align:center;}
        @media (max-width:900px) {
            .container { max-width:97vw; }
        }
        @media (max-width:600px) {
            .container { padding:12px 2vw;}
            h1 { font-size:1.25em;}
            .xp-block, .dip-block { padding:8px 7px;}
        }
        .xp-block input, .dip-block input { margin-bottom:0;}
        .tips { font-size:.93em; color:#5b6989; margin:7px 2px 5px 2px;}
        .dragzone {
            border:2px dashed #bcd6fa; border-radius:8px;
            background:#f8fbff; padding:15px 10px;
            text-align:center; color:#555b6a; font-size:1em;
            margin-bottom:7px; transition: border .25s;
        }
        .dragzone.dragover { border:2.5px solid #2644d3; background:#f2f8ff;}
    </style>
    <script>
        function addExp() {
            let container = document.getElementById("xp-container");
            let html = `<div class="xp-block row-flex">
                <input type="text" name="xp_poste" placeholder="Poste occupé" required>
                <input type="text" name="xp_entreprise" placeholder="Entreprise" required>
                <input type="text" name="xp_lieu" placeholder="Lieu" required>
                <input type="text" name="xp_debut" placeholder="Début (YYYY)" required>
                <input type="text" name="xp_fin" placeholder="Fin (YYYY)" required>
            </div>`;
            container.insertAdjacentHTML("beforeend", html);
        }
        function addDip() {
            let container = document.getElementById("dip-container");
            let html = `<div class="dip-block row-flex">
                <input type="text" name="dip_titre" placeholder="Intitulé diplôme" required>
                <input type="text" name="dip_lieu" placeholder="Établissement/ville" required>
                <input type="text" name="dip_date" placeholder="Date d'obtention" required>
            </div>`;
            container.insertAdjacentHTML("beforeend", html);
        }
        function validateForm(e) {
            let xpBlocks = document.querySelectorAll('.xp-block');
            let dipBlocks = document.querySelectorAll('.dip-block');
            let hasXp = false, hasDip = false;
            xpBlocks.forEach(xp => {
                let ok = true;
                xp.querySelectorAll('input').forEach(inp => { if(!inp.value) ok = false; });
                if(ok) hasXp = true;
            });
            dipBlocks.forEach(dip => {
                let ok = true;
                dip.querySelectorAll('input').forEach(inp => { if(!inp.value) ok = false; });
                if(ok) hasDip = true;
            });
            let cvFile = document.getElementById('cv_file').files.length > 0;
            if(!hasXp && !hasDip && !cvFile) {
                alert("Veuillez remplir au moins une expérience professionnelle, un diplôme, ou uploader votre CV !");
                e.preventDefault();
            }
        }
        window.onload = function() {
            document.getElementById('add-xp').onclick = addExp;
            document.getElementById('add-dip').onclick = addDip;
            document.getElementById('main-form').onsubmit = validateForm;

            // Drag'n'drop CV
            const dragzone = document.getElementById("dragzone");
            const cvfile = document.getElementById("cv_file");
            if (dragzone) {
                dragzone.addEventListener("dragover", function(e){ e.preventDefault(); dragzone.classList.add("dragover"); });
                dragzone.addEventListener("dragleave", function(e){ dragzone.classList.remove("dragover"); });
                dragzone.addEventListener("drop", function(e){
                    e.preventDefault(); dragzone.classList.remove("dragover");
                    if (e.dataTransfer.files.length) {
                        cvfile.files = e.dataTransfer.files;
                        dragzone.innerHTML = "CV chargé : " + e.dataTransfer.files[0].name;
                    }
                });
            }
        };
    </script>
</head>
<body>
    <div class="container">
        <h1>Générateur de CV, lettre de motivation et fiche de poste <span style="font-size:1.2em;">✨</span></h1>
        {% if error %}
            <div class="error-message">{{ error }}</div>
        {% endif %}
        <form method="POST" enctype="multipart/form-data" id="main-form" autocomplete="off">
            <label>Nom :</label>
            <input type="text" name="nom" required>
            <label>Prénom :</label>
            <input type="text" name="prenom" required>
            <label>Adresse :</label>
            <input type="text" name="adresse">
            <label>Téléphone :</label>
            <input type="text" name="telephone">
            <label>Email :</label>
            <input type="email" name="email">
            <label>Âge :</label>
            <input type="number" name="age">

            <div class="or-separator">— Remplissez au moins une expérience ou un diplôme, <span class="important">ou importez votre CV</span> —</div>
            
            <label>Expérience(s) professionnelle(s) :</label>
            <div id="xp-container">
                <div class="xp-block row-flex">
                    <input type="text" name="xp_poste" placeholder="Poste occupé" >
                    <input type="text" name="xp_entreprise" placeholder="Entreprise" >
                    <input type="text" name="xp_lieu" placeholder="Lieu" >
                    <input type="text" name="xp_debut" placeholder="Début (YYYY)" >
                    <input type="text" name="xp_fin" placeholder="Fin (YYYY)" >
                </div>
            </div>
            <button type="button" class="add-btn" id="add-xp">+ Ajouter une expérience</button>
            
            <label>Diplôme(s) :</label>
            <div id="dip-container">
                <div class="dip-block row-flex">
                    <input type="text" name="dip_titre" placeholder="Intitulé diplôme" >
                    <input type="text" name="dip_lieu" placeholder="Établissement/ville" >
                    <input type="text" name="dip_date" placeholder="Date d'obtention" >
                </div>
            </div>
            <button type="button" class="add-btn" id="add-dip">+ Ajouter un diplôme</button>

            <div class="or-separator">ou</div>
            <div class="file-upload">
                <label for="cv_file">Importer votre CV (.pdf ou .docx) :</label>
                <div id="dragzone" class="dragzone">
                    Glissez votre CV ici ou cliquez pour sélectionner le fichier.
                    <input type="file" id="cv_file" name="cv_file" accept=".pdf,.docx" style="display:none;" onclick="this.value=null;">
                </div>
            </div>
            
            <label>Offre d'emploi (copier/coller le texte complet de l'offre) :</label>
            <textarea name="description" required></textarea>
            
            <button type="submit" id="submit-btn">Générer CV & Lettre</button>
        </form>
        <div class="tips">
            <b>Conseil :</b> Plus vous remplissez d'infos et joignez un CV détaillé, plus les résultats seront précis et adaptés !
        </div>
    </div>
    <script>
        // Clique sur la zone pour ouvrir la boîte de sélection de fichiers
        document.getElementById('dragzone').onclick = function() {
            document.getElementById('cv_file').click();
        };
        // Update dragzone text on file select
        document.getElementById('cv_file').onchange = function() {
            if (this.files.length) {
                document.getElementById('dragzone').innerHTML = "CV chargé : " + this.files[0].name;
            }
        };
    </script>
</body>
</html>
